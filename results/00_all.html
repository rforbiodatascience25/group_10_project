<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>00_all</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="00_all_files/libs/clipboard/clipboard.min.js"></script>
<script src="00_all_files/libs/quarto-html/quarto.js"></script>
<script src="00_all_files/libs/quarto-html/popper.min.js"></script>
<script src="00_all_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="00_all_files/libs/quarto-html/anchor.min.js"></script>
<link href="00_all_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="00_all_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="00_all_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="00_all_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="00_all_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="00_all_files/libs/table1-1.0/table1_defaults.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">00_all</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="load" class="level1">
<h1>01_load</h1>
<section id="uploading-data" class="level2">
<h2 class="anchored" data-anchor-id="uploading-data">Uploading Data</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Data for this project comes from: <a href="https://www.kaggle.com/datasets/adilimadeddinehosni/multi-resistance-antibiotic-susceptibility/data" class="uri">https://www.kaggle.com/datasets/adilimadeddinehosni/multi-resistance-antibiotic-susceptibility/data</a></p>
</section>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load Libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"RKaggle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-data-folder" class="level3">
<h3 class="anchored" data-anchor-id="create-data-folder">Create Data Folder</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>raw_data_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"_raw"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>results_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"results"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( <span class="sc">!</span><span class="fu">dir.exists</span>(data_dir) ){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="at">path =</span> data_dir)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( <span class="sc">!</span><span class="fu">dir.exists</span>(raw_data_dir) ){</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="at">path =</span> raw_data_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( <span class="sc">!</span><span class="fu">dir.exists</span>(results_dir) ){</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="at">path =</span> results_dir)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="upload-data" class="level3">
<h3 class="anchored" data-anchor-id="upload-data">Upload Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>raw_file <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"_raw"</span>, <span class="st">"Bacteria_dataset_Multiresistance.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Download data from kaggle and save if not already present</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(raw_file)) {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> RKaggle<span class="sc">::</span><span class="fu">get_dataset</span>(<span class="st">"adilimadeddinehosni/multi-resistance-antibiotic-susceptibility"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(df, raw_file)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="clean" class="level1">
<h1>02_clean</h1>
<section id="load-libraries-1" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-1">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-functions" class="level2">
<h2 class="anchored" data-anchor-id="load-functions">Load Functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R/99_proj_func.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<p>Handling of different types of NAs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/_raw/Bacteria_dataset_Multiresistance.csv"</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">" "</span>, <span class="st">"NA"</span>, <span class="st">"?"</span>, <span class="st">"missing"</span>, <span class="st">"unknown"</span>, <span class="st">"None"</span>, <span class="st">"error"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p><strong>Analyze for duplicates and select relevant columns</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify any duplicates to remove </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dup_IDs <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(ID, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#No duplicates in the dataset</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>dup_IDs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ID                Name              Email             Address          
 [5] age.gender        Souches           Diabetes          Hypertension     
 [9] Hospital_before   Infection_Freq    AMX.AMP           AMC              
[13] CZ                FOX               CTX.CRO           IPM              
[17] GEN               AN                Acide.nalidixique ofx              
[21] CIP               C                 Co.trimoxazole    Furanes          
[25] colistine         Collection_Date   Notes             n                
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID, <span class="sc">-</span>Name, <span class="sc">-</span>Email, <span class="sc">-</span>Address, <span class="sc">-</span>Collection_Date, <span class="sc">-</span>Notes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Separate data into individual columns and remove NA rows</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(age.gender,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"/"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Souches, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Species"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">" "</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">extra =</span> <span class="st">"merge"</span>) <span class="sc">|&gt;</span>  <span class="co"># only separate based on the first space </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID) <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(Species))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Identify typos and inconsistencies in naming</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get_unique_counts is a function in 99_proj_func.R</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">colnames</span>(mdr_data), </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span> <span class="fu">get_unique_counts</span>(mdr_data, .x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Rename accordingly</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"E.cli"</span>, <span class="st">"E.coi"</span>, <span class="st">"E.coli"</span>, <span class="st">"E. coli"</span>) <span class="sc">~</span> <span class="st">"Escherichia coli"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Klbsiella pneumoniae"</span>, <span class="st">"Klebsie.lla pneumoniae"</span>) <span class="sc">~</span> <span class="st">"Klebsiella pneumoniae"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Enter.bacteria spp."</span>, <span class="st">"Enteobacteria spp."</span>) <span class="sc">~</span> <span class="st">"Enterobacteria spp."</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Prot.eus mirabilis"</span>, <span class="st">"Protus mirabilis"</span>, <span class="st">"Proeus mirabilis"</span>) <span class="sc">~</span> <span class="st">"Proteus mirabilis"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> Species <span class="co"># Keep everything else unchanged </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diabetes =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      Diabetes <span class="sc">==</span> <span class="st">"True"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Diabetes</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hypertension =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      Hypertension <span class="sc">==</span> <span class="st">"True"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Hypertension</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#fix_resistance is a function in 99_proj_func.R</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">colnames</span>(mdr_data)[<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(mdr_data))], fix_resistance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Save the cleaned data</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mdr_data, <span class="fu">here</span>(<span class="st">"data/02_dat_clean.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="augment" class="level1">
<h1>03_augment</h1>
<section id="load-libraries-2" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-2">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="load-functions-1">Load Functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R/99_proj_func.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data-1" class="level2">
<h2 class="anchored" data-anchor-id="load-data-1">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/02_dat_clean.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-new-table-with-name-and-class-of-antibiotics" class="level2">
<h2 class="anchored" data-anchor-id="create-new-table-with-name-and-class-of-antibiotics">Create New Table with Name and Class of Antibiotics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>antibiotic_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Antibiotic =</span> <span class="fu">c</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AMX.AMP"</span>, <span class="st">"AMC"</span>, <span class="st">"CZ"</span>, <span class="st">"FOX"</span>, <span class="st">"CTX.CRO"</span>, <span class="st">"IPM"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GEN"</span>, <span class="st">"AN"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acide.nalidixique"</span>, <span class="st">"ofx"</span>, <span class="st">"CIP"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C"</span>, <span class="st">"Co.trimoxazole"</span>, <span class="st">"Furanes"</span>, <span class="st">"colistine"</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Full_Name =</span> <span class="fu">c</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin / Ampicillin"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin + Clavulanic Acid"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cefazolin"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cefoxitin"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cefotaxime / Ceftriaxone"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Imipenem"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gentamicin"</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amikacin"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nalidixic Acid"</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ofloxacin"</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ciprofloxacin"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Chloramphenicol"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Trimethoprim + Sulfamethoxazole"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nitrofurantoin"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Colistin"</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Class =</span> <span class="fu">c</span>(</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># β-lactams (Beta-lactams)</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"β-lactams (Beta-lactams)"</span>,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aminoglycosides (Aminosides)</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Aminoglycosides (Aminosides)"</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Aminoglycosides (Aminosides)"</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quinolones / Fluoroquinolones</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Quinolones / Fluoroquinolones"</span>,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Quinolones / Fluoroquinolones"</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Quinolones / Fluoroquinolones"</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Other Important Agents</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Other Important Agents"</span>,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Other Important Agents"</span>,</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Other Important Agents"</span>,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Other Important Agents"</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>antibiotic_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 4
   Antibiotic        Full_Name                       Class      stringsAsFactors
   &lt;chr&gt;             &lt;chr&gt;                           &lt;chr&gt;      &lt;lgl&gt;           
 1 AMX.AMP           Amoxicillin / Ampicillin        β-lactams… FALSE           
 2 AMC               Amoxicillin + Clavulanic Acid   β-lactams… FALSE           
 3 CZ                Cefazolin                       β-lactams… FALSE           
 4 FOX               Cefoxitin                       β-lactams… FALSE           
 5 CTX.CRO           Cefotaxime / Ceftriaxone        β-lactams… FALSE           
 6 IPM               Imipenem                        β-lactams… FALSE           
 7 GEN               Gentamicin                      Aminoglyc… FALSE           
 8 AN                Amikacin                        Aminoglyc… FALSE           
 9 Acide.nalidixique Nalidixic Acid                  Quinolone… FALSE           
10 ofx               Ofloxacin                       Quinolone… FALSE           
11 CIP               Ciprofloxacin                   Quinolone… FALSE           
12 C                 Chloramphenicol                 Other Imp… FALSE           
13 Co.trimoxazole    Trimethoprim + Sulfamethoxazole Other Imp… FALSE           
14 Furanes           Nitrofurantoin                  Other Imp… FALSE           
15 colistine         Colistin                        Other Imp… FALSE           </code></pre>
</div>
</div>
</section>
<section id="joining-antibiotic-table-with-mdr-data" class="level2">
<h2 class="anchored" data-anchor-id="joining-antibiotic-table-with-mdr-data">Joining Antibiotic Table with MDR data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Antibiotic <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AMX.AMP"</span>, <span class="st">"AMC"</span>, <span class="st">"CZ"</span>, <span class="st">"FOX"</span>, <span class="st">"CTX.CRO"</span>, <span class="st">"IPM"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GEN"</span>, <span class="st">"AN"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acide.nalidixique"</span>, <span class="st">"ofx"</span>, <span class="st">"CIP"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C"</span>, <span class="st">"Co.trimoxazole"</span>, <span class="st">"Furanes"</span>, <span class="st">"colistine"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot MDR Data to long form</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>mdr_long <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(Antibiotic),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Antibiotic"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Resistance"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Join Antibiotics table to mdr_long </span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>mdr_joined <span class="ot">&lt;-</span> mdr_long <span class="sc">|&gt;</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(antibiotic_table, <span class="at">by=</span><span class="st">"Antibiotic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mdr_joined, <span class="fu">here</span>(<span class="st">"data/03_dat_aug_long.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mdr-variable" class="level2">
<h2 class="anchored" data-anchor-id="mdr-variable">MDR variable</h2>
<p>To make linear model we will need a MDR variable, which assigns a numerical score to the resistance profile of each isolate. For every antibiotic tested, we added <strong>1 point</strong> if the isolate was classified as <em>Resistant (R)</em> and <strong>0.5 points</strong> if it was classified as <em>Intermediate (I)</em>, while <em>Susceptible (S)</em> contributed <strong>0 points</strong>. By summing these values across all antibiotics for each sample, we obtained a continuous MDR score that reflects the degree of multidrug resistance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>antibiotics_cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mdr_data)[<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(mdr_data))]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply the case_when function to mutate every antibiotic column and sum into MDR variable</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Count resistance is a function in 99_proj_func.R</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>mdr_wide <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(antibiotics_cols, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>           count_resistance)) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MDR =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(antibiotics_cols))) <span class="sc">|&gt;</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(Age, Gender, Species, Diabetes, Hypertension, Hospital_before, Infection_Freq, MDR)   <span class="co">#Drop all NA in the columns used to model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(antibiotics_cols, count_resistance)`.
Caused by warning:
! Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(antibiotics_cols)

  # Now:
  data %&gt;% select(all_of(antibiotics_cols))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
</div>
<p>We have to convert all categorical variables to factors so that the linear model can correctly treat them as categorical predictors and generate the appropriate variables for the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mdr_wide <span class="ot">&lt;-</span> mdr_wide <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gender =</span> <span class="fu">factor</span>(Gender),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">factor</span>(Species),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diabetes =</span> <span class="fu">factor</span>(Diabetes),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hypertension =</span> <span class="fu">factor</span>(Hypertension),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hospital_before =</span> <span class="fu">factor</span>(Hospital_before),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Infection_Freq =</span> <span class="fu">factor</span>(Infection_Freq)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a dataframe in wide format with the variable <em>MDR</em>, including the resistance pattern using sparse encoding and ready for linear modelling and PCA.</p>
</section>
<section id="add-age-group-variable" class="level2">
<h2 class="anchored" data-anchor-id="add-age-group-variable">Add Age Group Variable</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">10</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"["</span>, <span class="fu">head</span>(breaks, <span class="sc">-</span><span class="dv">1</span>), <span class="st">","</span>, <span class="fu">tail</span>(breaks, <span class="sc">-</span><span class="dv">1</span>), <span class="st">"]"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>mdr_wide <span class="ot">&lt;-</span> mdr_wide <span class="sc">|&gt;</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">cut</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> Age,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">breaks =</span> breaks,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> labels))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mdr_wide, <span class="fu">here</span>(<span class="st">"data/03_dat_aug_wide.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="describe" class="level1">
<h1>04_describe</h1>
</section>
<section id="description-of-the-dataset" class="level1">
<h1>Description of the Dataset</h1>
<section id="load-libraries-3" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-3">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"table1"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"htmltools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data-2" class="level2">
<h2 class="anchored" data-anchor-id="load-data-2">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/02_dat_clean.csv"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mdr_long <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_long.csv"</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>mdr_wide <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_wide.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-functions-2" class="level2">
<h2 class="anchored" data-anchor-id="load-functions-2">Load Functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"R/99_proj_func.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-inspection" class="level2">
<h2 class="anchored" data-anchor-id="data-inspection">Data Inspection</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of rows &amp; columns</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mdr_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9947   22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mdr_data <span class="sc">|&gt;</span> <span class="fu">sample_n</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Age Gender                Species Diabetes Hypertension Hospital_before
1   87      F      Proteus mirabilis      Yes           No              No
2   19      F       Escherichia coli       No           No             Yes
3   39      F       Escherichia coli       No           No              No
4   39      F Pseudomonas aeruginosa      Yes           No              No
5   83      F    Enterobacteria spp.       No           No              No
6   81      F       Escherichia coli       No           No              No
7   75      F       Escherichia coli       No           No             Yes
8   41      F       Escherichia coli       No           No             Yes
9   27      F    Enterobacteria spp.       No           No             Yes
10  48      M       Citrobacter spp.       No           No              No
   Infection_Freq AMX.AMP AMC CZ FOX CTX.CRO IPM GEN AN Acide.nalidixique ofx
1               0       R   R  S   R       S   S   S  R                 S   S
2               1       R   R  R   S       R   S   S  R                 S   S
3               1       S   R  R   R       S   S   S  S                 S   S
4               0       R   S  R   S       S   R   S  S                 S   S
5               3       R   S  S   S       S   S   S  S                 S   S
6               2       R   R  R   S       R   S   S  S                 S   S
7               3       R   R  R   R       R   S   R  S                 S   S
8               3       R   R  R   R       R   R   S  R                 S   S
9               3       S   R  R   S       S   S   S  R                 S   S
10              0       R   R  R   R       S   S   R  S                 S   S
   CIP C Co.trimoxazole Furanes colistine
1    S S              S       S         S
2    S S              S       S         S
3    S S              S       S         S
4    S S              S       R         S
5    S S              S       S         S
6    S S              S       S         S
7    R S              R       S         S
8    R S              R       S         R
9    S S              S       S         S
10   S S              S       S         S</code></pre>
</div>
</div>
</section>
<section id="data-table" class="level2">
<h2 class="anchored" data-anchor-id="data-table">Data Table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table describing the data per species</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">table1</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> Age <span class="sc">+</span> Gender  <span class="sc">+</span> Diabetes <span class="sc">+</span> Hypertension <span class="sc">+</span> Hospital_before <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    Infection_Freq <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    AMX.AMP <span class="sc">+</span> AMC <span class="sc">+</span> CZ <span class="sc">+</span> FOX <span class="sc">+</span> CTX.CRO <span class="sc">+</span> IPM <span class="sc">+</span> GEN <span class="sc">+</span> AN <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    Acide.nalidixique <span class="sc">+</span> ofx <span class="sc">+</span> CIP <span class="sc">+</span> C <span class="sc">+</span> Co.trimoxazole <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    Furanes <span class="sc">+</span> colistine</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span> Species,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mdr_data</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>html_table <span class="ot">&lt;-</span> <span class="fu">as.tags</span>(t1) </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>html_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Acinetobacter baumannii<br>
<span class="stratn">(N=181)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Citrobacter spp.<br>
<span class="stratn">(N=481)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Enterobacteria spp.<br>
<span class="stratn">(N=997)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Escherichia coli<br>
<span class="stratn">(N=6083)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Klebsiella pneumoniae<br>
<span class="stratn">(N=702)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Morganella morganii<br>
<span class="stratn">(N=305)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Proteus mirabilis<br>
<span class="stratn">(N=742)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Pseudomonas aeruginosa<br>
<span class="stratn">(N=200)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Serratia marcescens<br>
<span class="stratn">(N=256)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=9947)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow"><span class="varlabel">Age</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>46.9 (23.1)</td>
<td>43.8 (24.1)</td>
<td>46.5 (25.5)</td>
<td>45.3 (25.0)</td>
<td>47.1 (24.5)</td>
<td>44.8 (24.7)</td>
<td>45.4 (24.8)</td>
<td>47.9 (25.0)</td>
<td>46.7 (24.5)</td>
<td>45.6 (24.9)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">44.0 [1.00, 90.0]</td>
<td class="lastrow">43.0 [0, 90.0]</td>
<td class="lastrow">45.0 [0, 90.0]</td>
<td class="lastrow">45.0 [0, 90.0]</td>
<td class="lastrow">46.0 [0, 90.0]</td>
<td class="lastrow">45.0 [0, 90.0]</td>
<td class="lastrow">45.0 [0, 90.0]</td>
<td class="lastrow">46.5 [0, 90.0]</td>
<td class="lastrow">48.0 [0, 90.0]</td>
<td class="lastrow">45.0 [0, 90.0]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Gender</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">F</td>
<td>144 (79.6%)</td>
<td>383 (79.6%)</td>
<td>793 (79.5%)</td>
<td>4834 (79.5%)</td>
<td>562 (80.1%)</td>
<td>256 (83.9%)</td>
<td>593 (79.9%)</td>
<td>156 (78.0%)</td>
<td>208 (81.3%)</td>
<td>7929 (79.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">M</td>
<td class="lastrow">37 (20.4%)</td>
<td class="lastrow">98 (20.4%)</td>
<td class="lastrow">204 (20.5%)</td>
<td class="lastrow">1249 (20.5%)</td>
<td class="lastrow">140 (19.9%)</td>
<td class="lastrow">49 (16.1%)</td>
<td class="lastrow">149 (20.1%)</td>
<td class="lastrow">44 (22.0%)</td>
<td class="lastrow">48 (18.8%)</td>
<td class="lastrow">2018 (20.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow"><span class="varlabel">Diabetes</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>134 (74.0%)</td>
<td>377 (78.4%)</td>
<td>797 (79.9%)</td>
<td>4805 (79.0%)</td>
<td>566 (80.6%)</td>
<td>242 (79.3%)</td>
<td>593 (79.9%)</td>
<td>156 (78.0%)</td>
<td>213 (83.2%)</td>
<td>7883 (79.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">47 (26.0%)</td>
<td class="lastrow">104 (21.6%)</td>
<td class="lastrow">200 (20.1%)</td>
<td class="lastrow">1278 (21.0%)</td>
<td class="lastrow">136 (19.4%)</td>
<td class="lastrow">63 (20.7%)</td>
<td class="lastrow">149 (20.1%)</td>
<td class="lastrow">44 (22.0%)</td>
<td class="lastrow">43 (16.8%)</td>
<td class="lastrow">2064 (20.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Hypertension</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>148 (81.8%)</td>
<td>348 (72.3%)</td>
<td>744 (74.6%)</td>
<td>4561 (75.0%)</td>
<td>535 (76.2%)</td>
<td>225 (73.8%)</td>
<td>573 (77.2%)</td>
<td>150 (75.0%)</td>
<td>186 (72.7%)</td>
<td>7470 (75.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">33 (18.2%)</td>
<td class="lastrow">133 (27.7%)</td>
<td class="lastrow">253 (25.4%)</td>
<td class="lastrow">1522 (25.0%)</td>
<td class="lastrow">167 (23.8%)</td>
<td class="lastrow">80 (26.2%)</td>
<td class="lastrow">169 (22.8%)</td>
<td class="lastrow">50 (25.0%)</td>
<td class="lastrow">70 (27.3%)</td>
<td class="lastrow">2477 (24.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow"><span class="varlabel">Hospital_before</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>119 (65.7%)</td>
<td>340 (70.7%)</td>
<td>707 (70.9%)</td>
<td>4277 (70.3%)</td>
<td>495 (70.5%)</td>
<td>222 (72.8%)</td>
<td>527 (71.0%)</td>
<td>144 (72.0%)</td>
<td>177 (69.1%)</td>
<td>7008 (70.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">62 (34.3%)</td>
<td class="lastrow">141 (29.3%)</td>
<td class="lastrow">290 (29.1%)</td>
<td class="lastrow">1806 (29.7%)</td>
<td class="lastrow">207 (29.5%)</td>
<td class="lastrow">83 (27.2%)</td>
<td class="lastrow">215 (29.0%)</td>
<td class="lastrow">56 (28.0%)</td>
<td class="lastrow">79 (30.9%)</td>
<td class="lastrow">2939 (29.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Infection_Freq</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>1.67 (1.03)</td>
<td>1.46 (0.997)</td>
<td>1.55 (1.01)</td>
<td>1.50 (1.02)</td>
<td>1.61 (1.03)</td>
<td>1.49 (1.03)</td>
<td>1.54 (1.02)</td>
<td>1.55 (1.05)</td>
<td>1.43 (0.979)</td>
<td>1.51 (1.02)</td>
</tr>
<tr class="even">
<td class="rowlabel">Median [Min, Max]</td>
<td>2.00 [0, 3.00]</td>
<td>1.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
<td>1.00 [0, 3.00]</td>
<td>2.00 [0, 3.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">4 (2.2%)</td>
<td class="lastrow">13 (2.7%)</td>
<td class="lastrow">27 (2.7%)</td>
<td class="lastrow">134 (2.2%)</td>
<td class="lastrow">8 (1.1%)</td>
<td class="lastrow">13 (4.3%)</td>
<td class="lastrow">23 (3.1%)</td>
<td class="lastrow">3 (1.5%)</td>
<td class="lastrow">8 (3.1%)</td>
<td class="lastrow">233 (2.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">AMX.AMP</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>5 (2.8%)</td>
<td>6 (1.2%)</td>
<td>13 (1.3%)</td>
<td>118 (1.9%)</td>
<td>17 (2.4%)</td>
<td>5 (1.6%)</td>
<td>9 (1.2%)</td>
<td>3 (1.5%)</td>
<td>6 (2.3%)</td>
<td>182 (1.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>56 (30.9%)</td>
<td>221 (45.9%)</td>
<td>404 (40.5%)</td>
<td>4203 (69.1%)</td>
<td>403 (57.4%)</td>
<td>61 (20.0%)</td>
<td>249 (33.6%)</td>
<td>72 (36.0%)</td>
<td>40 (15.6%)</td>
<td>5709 (57.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">120 (66.3%)</td>
<td class="lastrow">254 (52.8%)</td>
<td class="lastrow">580 (58.2%)</td>
<td class="lastrow">1762 (29.0%)</td>
<td class="lastrow">282 (40.2%)</td>
<td class="lastrow">239 (78.4%)</td>
<td class="lastrow">484 (65.2%)</td>
<td class="lastrow">125 (62.5%)</td>
<td class="lastrow">210 (82.0%)</td>
<td class="lastrow">4056 (40.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">AMC</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>2 (1.1%)</td>
<td>7 (1.5%)</td>
<td>20 (2.0%)</td>
<td>104 (1.7%)</td>
<td>11 (1.6%)</td>
<td>3 (1.0%)</td>
<td>11 (1.5%)</td>
<td>7 (3.5%)</td>
<td>2 (0.8%)</td>
<td>167 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>71 (39.2%)</td>
<td>226 (47.0%)</td>
<td>419 (42.0%)</td>
<td>4218 (69.3%)</td>
<td>398 (56.7%)</td>
<td>84 (27.5%)</td>
<td>278 (37.5%)</td>
<td>65 (32.5%)</td>
<td>51 (19.9%)</td>
<td>5810 (58.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">108 (59.7%)</td>
<td class="lastrow">248 (51.6%)</td>
<td class="lastrow">558 (56.0%)</td>
<td class="lastrow">1761 (28.9%)</td>
<td class="lastrow">293 (41.7%)</td>
<td class="lastrow">218 (71.5%)</td>
<td class="lastrow">453 (61.1%)</td>
<td class="lastrow">128 (64.0%)</td>
<td class="lastrow">203 (79.3%)</td>
<td class="lastrow">3970 (39.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">CZ</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>3 (1.7%)</td>
<td>4 (0.8%)</td>
<td>21 (2.1%)</td>
<td>108 (1.8%)</td>
<td>9 (1.3%)</td>
<td>2 (0.7%)</td>
<td>8 (1.1%)</td>
<td>7 (3.5%)</td>
<td>3 (1.2%)</td>
<td>165 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>58 (32.0%)</td>
<td>226 (47.0%)</td>
<td>414 (41.5%)</td>
<td>4156 (68.3%)</td>
<td>383 (54.6%)</td>
<td>77 (25.2%)</td>
<td>260 (35.0%)</td>
<td>67 (33.5%)</td>
<td>48 (18.8%)</td>
<td>5689 (57.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">120 (66.3%)</td>
<td class="lastrow">251 (52.2%)</td>
<td class="lastrow">562 (56.4%)</td>
<td class="lastrow">1819 (29.9%)</td>
<td class="lastrow">310 (44.2%)</td>
<td class="lastrow">226 (74.1%)</td>
<td class="lastrow">474 (63.9%)</td>
<td class="lastrow">126 (63.0%)</td>
<td class="lastrow">205 (80.1%)</td>
<td class="lastrow">4093 (41.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">FOX</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>4 (2.2%)</td>
<td>7 (1.5%)</td>
<td>14 (1.4%)</td>
<td>113 (1.9%)</td>
<td>15 (2.1%)</td>
<td>0 (0%)</td>
<td>7 (0.9%)</td>
<td>3 (1.5%)</td>
<td>3 (1.2%)</td>
<td>166 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>57 (31.5%)</td>
<td>221 (45.9%)</td>
<td>396 (39.7%)</td>
<td>4196 (69.0%)</td>
<td>399 (56.8%)</td>
<td>82 (26.9%)</td>
<td>281 (37.9%)</td>
<td>65 (32.5%)</td>
<td>37 (14.5%)</td>
<td>5734 (57.6%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">120 (66.3%)</td>
<td class="lastrow">253 (52.6%)</td>
<td class="lastrow">587 (58.9%)</td>
<td class="lastrow">1774 (29.2%)</td>
<td class="lastrow">288 (41.0%)</td>
<td class="lastrow">223 (73.1%)</td>
<td class="lastrow">454 (61.2%)</td>
<td class="lastrow">132 (66.0%)</td>
<td class="lastrow">216 (84.4%)</td>
<td class="lastrow">4047 (40.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">CTX.CRO</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>4 (2.2%)</td>
<td>6 (1.2%)</td>
<td>18 (1.8%)</td>
<td>118 (1.9%)</td>
<td>11 (1.6%)</td>
<td>3 (1.0%)</td>
<td>12 (1.6%)</td>
<td>3 (1.5%)</td>
<td>5 (2.0%)</td>
<td>180 (1.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>71 (39.2%)</td>
<td>211 (43.9%)</td>
<td>395 (39.6%)</td>
<td>4192 (68.9%)</td>
<td>419 (59.7%)</td>
<td>83 (27.2%)</td>
<td>259 (34.9%)</td>
<td>72 (36.0%)</td>
<td>44 (17.2%)</td>
<td>5746 (57.8%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">106 (58.6%)</td>
<td class="lastrow">264 (54.9%)</td>
<td class="lastrow">584 (58.6%)</td>
<td class="lastrow">1773 (29.1%)</td>
<td class="lastrow">272 (38.7%)</td>
<td class="lastrow">219 (71.8%)</td>
<td class="lastrow">471 (63.5%)</td>
<td class="lastrow">125 (62.5%)</td>
<td class="lastrow">207 (80.9%)</td>
<td class="lastrow">4021 (40.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">IPM</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>4 (2.2%)</td>
<td>3 (0.6%)</td>
<td>26 (2.6%)</td>
<td>111 (1.8%)</td>
<td>12 (1.7%)</td>
<td>2 (0.7%)</td>
<td>13 (1.8%)</td>
<td>3 (1.5%)</td>
<td>5 (2.0%)</td>
<td>179 (1.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>61 (33.7%)</td>
<td>213 (44.3%)</td>
<td>409 (41.0%)</td>
<td>4219 (69.4%)</td>
<td>390 (55.6%)</td>
<td>64 (21.0%)</td>
<td>248 (33.4%)</td>
<td>67 (33.5%)</td>
<td>45 (17.6%)</td>
<td>5716 (57.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">116 (64.1%)</td>
<td class="lastrow">265 (55.1%)</td>
<td class="lastrow">562 (56.4%)</td>
<td class="lastrow">1753 (28.8%)</td>
<td class="lastrow">300 (42.7%)</td>
<td class="lastrow">239 (78.4%)</td>
<td class="lastrow">481 (64.8%)</td>
<td class="lastrow">130 (65.0%)</td>
<td class="lastrow">206 (80.5%)</td>
<td class="lastrow">4052 (40.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">GEN</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>3 (1.7%)</td>
<td>7 (1.5%)</td>
<td>16 (1.6%)</td>
<td>101 (1.7%)</td>
<td>18 (2.6%)</td>
<td>2 (0.7%)</td>
<td>7 (0.9%)</td>
<td>7 (3.5%)</td>
<td>2 (0.8%)</td>
<td>163 (1.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>31 (17.1%)</td>
<td>73 (15.2%)</td>
<td>177 (17.8%)</td>
<td>1122 (18.4%)</td>
<td>202 (28.8%)</td>
<td>45 (14.8%)</td>
<td>146 (19.7%)</td>
<td>42 (21.0%)</td>
<td>93 (36.3%)</td>
<td>1931 (19.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">147 (81.2%)</td>
<td class="lastrow">401 (83.4%)</td>
<td class="lastrow">804 (80.6%)</td>
<td class="lastrow">4860 (79.9%)</td>
<td class="lastrow">482 (68.7%)</td>
<td class="lastrow">258 (84.6%)</td>
<td class="lastrow">589 (79.4%)</td>
<td class="lastrow">151 (75.5%)</td>
<td class="lastrow">161 (62.9%)</td>
<td class="lastrow">7853 (78.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">AN</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>5 (2.8%)</td>
<td>5 (1.0%)</td>
<td>17 (1.7%)</td>
<td>109 (1.8%)</td>
<td>13 (1.9%)</td>
<td>5 (1.6%)</td>
<td>6 (0.8%)</td>
<td>3 (1.5%)</td>
<td>5 (2.0%)</td>
<td>168 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>31 (17.1%)</td>
<td>78 (16.2%)</td>
<td>169 (17.0%)</td>
<td>1095 (18.0%)</td>
<td>204 (29.1%)</td>
<td>54 (17.7%)</td>
<td>133 (17.9%)</td>
<td>47 (23.5%)</td>
<td>93 (36.3%)</td>
<td>1904 (19.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">145 (80.1%)</td>
<td class="lastrow">398 (82.7%)</td>
<td class="lastrow">811 (81.3%)</td>
<td class="lastrow">4879 (80.2%)</td>
<td class="lastrow">485 (69.1%)</td>
<td class="lastrow">246 (80.7%)</td>
<td class="lastrow">603 (81.3%)</td>
<td class="lastrow">150 (75.0%)</td>
<td class="lastrow">158 (61.7%)</td>
<td class="lastrow">7875 (79.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Acide.nalidixique</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>3 (1.7%)</td>
<td>6 (1.2%)</td>
<td>21 (2.1%)</td>
<td>118 (1.9%)</td>
<td>12 (1.7%)</td>
<td>5 (1.6%)</td>
<td>9 (1.2%)</td>
<td>8 (4.0%)</td>
<td>4 (1.6%)</td>
<td>186 (1.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>9 (5.0%)</td>
<td>26 (5.4%)</td>
<td>64 (6.4%)</td>
<td>1089 (17.9%)</td>
<td>32 (4.6%)</td>
<td>39 (12.8%)</td>
<td>95 (12.8%)</td>
<td>13 (6.5%)</td>
<td>19 (7.4%)</td>
<td>1386 (13.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">169 (93.4%)</td>
<td class="lastrow">449 (93.3%)</td>
<td class="lastrow">912 (91.5%)</td>
<td class="lastrow">4876 (80.2%)</td>
<td class="lastrow">658 (93.7%)</td>
<td class="lastrow">261 (85.6%)</td>
<td class="lastrow">638 (86.0%)</td>
<td class="lastrow">179 (89.5%)</td>
<td class="lastrow">233 (91.0%)</td>
<td class="lastrow">8375 (84.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">ofx</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>5 (2.8%)</td>
<td>4 (0.8%)</td>
<td>20 (2.0%)</td>
<td>104 (1.7%)</td>
<td>12 (1.7%)</td>
<td>3 (1.0%)</td>
<td>12 (1.6%)</td>
<td>4 (2.0%)</td>
<td>1 (0.4%)</td>
<td>165 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>17 (9.4%)</td>
<td>24 (5.0%)</td>
<td>68 (6.8%)</td>
<td>1055 (17.3%)</td>
<td>43 (6.1%)</td>
<td>48 (15.7%)</td>
<td>88 (11.9%)</td>
<td>16 (8.0%)</td>
<td>19 (7.4%)</td>
<td>1378 (13.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">159 (87.8%)</td>
<td class="lastrow">453 (94.2%)</td>
<td class="lastrow">909 (91.2%)</td>
<td class="lastrow">4924 (80.9%)</td>
<td class="lastrow">647 (92.2%)</td>
<td class="lastrow">254 (83.3%)</td>
<td class="lastrow">642 (86.5%)</td>
<td class="lastrow">180 (90.0%)</td>
<td class="lastrow">236 (92.2%)</td>
<td class="lastrow">8404 (84.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">CIP</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>5 (2.8%)</td>
<td>6 (1.2%)</td>
<td>22 (2.2%)</td>
<td>110 (1.8%)</td>
<td>9 (1.3%)</td>
<td>4 (1.3%)</td>
<td>8 (1.1%)</td>
<td>4 (2.0%)</td>
<td>5 (2.0%)</td>
<td>173 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>14 (7.7%)</td>
<td>28 (5.8%)</td>
<td>72 (7.2%)</td>
<td>1119 (18.4%)</td>
<td>55 (7.8%)</td>
<td>38 (12.5%)</td>
<td>92 (12.4%)</td>
<td>15 (7.5%)</td>
<td>11 (4.3%)</td>
<td>1444 (14.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">162 (89.5%)</td>
<td class="lastrow">447 (92.9%)</td>
<td class="lastrow">903 (90.6%)</td>
<td class="lastrow">4854 (79.8%)</td>
<td class="lastrow">638 (90.9%)</td>
<td class="lastrow">263 (86.2%)</td>
<td class="lastrow">642 (86.5%)</td>
<td class="lastrow">181 (90.5%)</td>
<td class="lastrow">240 (93.8%)</td>
<td class="lastrow">8330 (83.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">C</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>5 (2.8%)</td>
<td>7 (1.5%)</td>
<td>22 (2.2%)</td>
<td>114 (1.9%)</td>
<td>7 (1.0%)</td>
<td>4 (1.3%)</td>
<td>9 (1.2%)</td>
<td>4 (2.0%)</td>
<td>4 (1.6%)</td>
<td>176 (1.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>24 (13.3%)</td>
<td>22 (4.6%)</td>
<td>70 (7.0%)</td>
<td>1123 (18.5%)</td>
<td>49 (7.0%)</td>
<td>14 (4.6%)</td>
<td>56 (7.5%)</td>
<td>19 (9.5%)</td>
<td>5 (2.0%)</td>
<td>1382 (13.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">152 (84.0%)</td>
<td class="lastrow">452 (94.0%)</td>
<td class="lastrow">905 (90.8%)</td>
<td class="lastrow">4846 (79.7%)</td>
<td class="lastrow">646 (92.0%)</td>
<td class="lastrow">287 (94.1%)</td>
<td class="lastrow">677 (91.2%)</td>
<td class="lastrow">177 (88.5%)</td>
<td class="lastrow">247 (96.5%)</td>
<td class="lastrow">8389 (84.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Co.trimoxazole</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>4 (2.2%)</td>
<td>4 (0.8%)</td>
<td>20 (2.0%)</td>
<td>117 (1.9%)</td>
<td>10 (1.4%)</td>
<td>2 (0.7%)</td>
<td>5 (0.7%)</td>
<td>5 (2.5%)</td>
<td>2 (0.8%)</td>
<td>169 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>18 (9.9%)</td>
<td>43 (8.9%)</td>
<td>66 (6.6%)</td>
<td>1150 (18.9%)</td>
<td>36 (5.1%)</td>
<td>19 (6.2%)</td>
<td>41 (5.5%)</td>
<td>22 (11.0%)</td>
<td>18 (7.0%)</td>
<td>1413 (14.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">159 (87.8%)</td>
<td class="lastrow">434 (90.2%)</td>
<td class="lastrow">911 (91.4%)</td>
<td class="lastrow">4816 (79.2%)</td>
<td class="lastrow">656 (93.4%)</td>
<td class="lastrow">284 (93.1%)</td>
<td class="lastrow">696 (93.8%)</td>
<td class="lastrow">173 (86.5%)</td>
<td class="lastrow">236 (92.2%)</td>
<td class="lastrow">8365 (84.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">Furanes</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>2 (1.1%)</td>
<td>5 (1.0%)</td>
<td>21 (2.1%)</td>
<td>110 (1.8%)</td>
<td>9 (1.3%)</td>
<td>4 (1.3%)</td>
<td>10 (1.3%)</td>
<td>4 (2.0%)</td>
<td>3 (1.2%)</td>
<td>168 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>19 (10.5%)</td>
<td>39 (8.1%)</td>
<td>54 (5.4%)</td>
<td>1068 (17.6%)</td>
<td>46 (6.6%)</td>
<td>24 (7.9%)</td>
<td>41 (5.5%)</td>
<td>20 (10.0%)</td>
<td>11 (4.3%)</td>
<td>1322 (13.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">160 (88.4%)</td>
<td class="lastrow">437 (90.9%)</td>
<td class="lastrow">922 (92.5%)</td>
<td class="lastrow">4905 (80.6%)</td>
<td class="lastrow">647 (92.2%)</td>
<td class="lastrow">277 (90.8%)</td>
<td class="lastrow">691 (93.1%)</td>
<td class="lastrow">176 (88.0%)</td>
<td class="lastrow">242 (94.5%)</td>
<td class="lastrow">8457 (85.0%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow"><span class="varlabel">colistine</span></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">I</td>
<td>4 (2.2%)</td>
<td>6 (1.2%)</td>
<td>25 (2.5%)</td>
<td>112 (1.8%)</td>
<td>13 (1.9%)</td>
<td>4 (1.3%)</td>
<td>14 (1.9%)</td>
<td>5 (2.5%)</td>
<td>3 (1.2%)</td>
<td>186 (1.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel">R</td>
<td>26 (14.4%)</td>
<td>31 (6.4%)</td>
<td>61 (6.1%)</td>
<td>1074 (17.7%)</td>
<td>34 (4.8%)</td>
<td>16 (5.2%)</td>
<td>42 (5.7%)</td>
<td>26 (13.0%)</td>
<td>27 (10.5%)</td>
<td>1337 (13.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">S</td>
<td class="lastrow">151 (83.4%)</td>
<td class="lastrow">444 (92.3%)</td>
<td class="lastrow">911 (91.4%)</td>
<td class="lastrow">4897 (80.5%)</td>
<td class="lastrow">655 (93.3%)</td>
<td class="lastrow">285 (93.4%)</td>
<td class="lastrow">686 (92.5%)</td>
<td class="lastrow">169 (84.5%)</td>
<td class="lastrow">226 (88.3%)</td>
<td class="lastrow">8424 (84.7%)</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap table in div to shrink</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>html_table_resized <span class="ot">&lt;-</span> tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">"overflow-x:auto; max-width:100%; zoom:0.7;"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tags</span>(t1)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Save HTML to results/images in project</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save_html</span>(html_table_resized, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"results/images/04_table_1_resized.html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table-describing-antibiotic-full-names-class" class="level2">
<h2 class="anchored" data-anchor-id="table-describing-antibiotic-full-names-class">Table Describing Antibiotic Full Names &amp; Class</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mdr_long <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Antibiotic, Full_Name, Class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Antibiotic                       Full_Name
1            AMX.AMP        Amoxicillin / Ampicillin
2                AMC   Amoxicillin + Clavulanic Acid
3                 CZ                       Cefazolin
4                FOX                       Cefoxitin
5            CTX.CRO        Cefotaxime / Ceftriaxone
6                IPM                        Imipenem
7                GEN                      Gentamicin
8                 AN                        Amikacin
9  Acide.nalidixique                  Nalidixic Acid
10               ofx                       Ofloxacin
11               CIP                   Ciprofloxacin
12                 C                 Chloramphenicol
13    Co.trimoxazole Trimethoprim + Sulfamethoxazole
14           Furanes                  Nitrofurantoin
15         colistine                        Colistin
                           Class
1       β-lactams (Beta-lactams)
2       β-lactams (Beta-lactams)
3       β-lactams (Beta-lactams)
4       β-lactams (Beta-lactams)
5       β-lactams (Beta-lactams)
6       β-lactams (Beta-lactams)
7   Aminoglycosides (Aminosides)
8   Aminoglycosides (Aminosides)
9  Quinolones / Fluoroquinolones
10 Quinolones / Fluoroquinolones
11 Quinolones / Fluoroquinolones
12        Other Important Agents
13        Other Important Agents
14        Other Important Agents
15        Other Important Agents</code></pre>
</div>
</div>
</section>
<section id="visualisation-of-variable-distributions" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-of-variable-distributions">Visualisation of Variable Distributions</h2>
<p><strong>Age and Gender</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p1  <span class="ot">&lt;-</span> mdr_wide <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> _, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">fill =</span> Gender)) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2000</span>, <span class="dv">250</span>)) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"Age"</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Age Distribution by Gender"</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-29-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save_png is a function in 99_proj_func.R</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_png</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot     =</span> p1,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"results/images/04_Age_Gender.png"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Species</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> mdr_data <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> _, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> ..count..),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,        <span class="co"># raise text above bars</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.2</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6000</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"Species"</span>, </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Species Distribution"</span>) <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-30-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_png</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot     =</span> p2,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"results/images/04_Species.png"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Age Distribution per Species</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mdr_data, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Age, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Age Distribution by Species"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Species"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-31-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_png</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot     =</span> p3,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"results/images/04_Age_Species.png"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Hypertension, Diabetes, Hospital before, Infection Freq</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_bar is a function in 99_proj_func.R</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">plot_bar</span>(mdr_data, Diabetes, <span class="st">"Diabetes"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">plot_bar</span>(mdr_data, Hypertension, <span class="st">"Hypertension"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">plot_bar</span>(mdr_data, Hospital_before, <span class="st">"Hospital Before"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">plot_bar</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        mdr_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Infection_Freq =</span> <span class="fu">factor</span>(Infection_Freq, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        Infection_Freq,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Infection Freq"</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> (p4 <span class="sc">+</span> p5) <span class="sc">/</span> (p6 <span class="sc">+</span> p7)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>p8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-32-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_png</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot     =</span> p8,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"results/images/04_Characteristics.png"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Antibiotic Resistance Profiles</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert resistance to a factor </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mdr_long<span class="sc">$</span>Resistance <span class="ot">&lt;-</span> <span class="fu">factor</span>(mdr_long<span class="sc">$</span>Resistance,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"S"</span>,<span class="st">"I"</span>,<span class="st">"R"</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mdr_long, <span class="fu">aes</span>(<span class="at">x =</span> Antibiotic, <span class="at">fill =</span> Resistance)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Resistance Profile by Antibiotic"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Antibiotic"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percent"</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>p9</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-33-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_png</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot     =</span> p9,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"results/images/04_Resistance_Profile.png"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="linear_model_mdr" class="level1">
<h1>05_linear_model_MDR</h1>
</section>
<section id="multidrug-resistance-linear-model" class="level1">
<h1>Multidrug Resistance Linear Model</h1>
<p>The objective of this analysis is to model, using linear models, the number of antibiotic resistances that an infection will present based on different individual and clinical characteristics, thereby allowing us to draw conclusions about which of these factors have the greatest impact on the development of antibiotic multiresistance.</p>
<section id="load-libraries-4" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-4">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"broom"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data-3" class="level2">
<h2 class="anchored" data-anchor-id="load-data-3">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>MDR_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_wide.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mdr-variable-1" class="level2">
<h2 class="anchored" data-anchor-id="mdr-variable-1">MDR variable</h2>
<p>To do the analysis we construct in 03_augment.qmd the MDR variable assigning a numerical score to the resistance profile of each isolate. For every antibiotic tested, we added <strong>1 point</strong> if the isolate was classified as <em>Resistant (R)</em> and <strong>0.5 points</strong> if it was classified as <em>Intermediate (I)</em>, while <em>Susceptible (S)</em> contributed <strong>0 points</strong>. By summing these values across all antibiotics for each sample, we obtained a continuous MDR score that reflects the degree of multidrug resistance.</p>
</section>
<section id="linear-model" class="level2">
<h2 class="anchored" data-anchor-id="linear-model">Linear Model</h2>
<p>The linear model estimates how each clinical and bacterial variable affects MDR. Because categorical predictors use dummy coding, the intercept represents the expected MDR for the <strong>reference categories</strong>: <em>Acinetobacter baumanni,</em> female gender, no diabetes, no hypertension, no prior hospitalization and Infection_Freq = 0. All other coefficients indicate how MDR changes relative to these reference groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>linear_model <span class="ot">&lt;-</span> MDR_df <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> MDR <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Species <span class="sc">+</span> Diabetes <span class="sc">+</span> Hypertension <span class="sc">+</span> Hospital_before <span class="sc">+</span> Infection_Freq,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> _)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>tidy_lm <span class="ot">&lt;-</span> <span class="fu">tidy</span>(linear_model, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.level =</span> <span class="fl">0.95</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Species"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Yes"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"GenderM"</span>, <span class="st">"Gender_M"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq1"</span>, <span class="st">"Freq_1"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq2"</span>, <span class="st">"Freq_2"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq3"</span>, <span class="st">"Freq_3"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">factor</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>))</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>tidy_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 8
   term           estimate std.error statistic  p.value conf.low conf.high sig  
   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;
 1 (Intercept)     3.21     0.167       19.3   4.28e-81  2.88e+0   3.53    TRUE 
 2 Age             0.00102  0.000847     1.21  2.26e- 1 -6.36e-4   0.00268 FALSE
 3 Gender_M        0.0876   0.0525       1.67  9.51e- 2 -1.53e-2   0.190   FALSE
 4 Citrobacter s…  0.317    0.183        1.73  8.39e- 2 -4.25e-2   0.676   FALSE
 5 Enterobacteri…  0.125    0.170        0.734 4.63e- 1 -2.08e-1   0.457   FALSE
 6 Escherichia c…  2.64     0.158       16.6   2.42e-61  2.33e+0   2.95    TRUE 
 7 Klebsiella pn…  1.27     0.175        7.24  4.73e-13  9.24e-1   1.61    TRUE 
 8 Morganella mo… -0.727    0.198       -3.67  2.39e- 4 -1.12e+0  -0.339   TRUE 
 9 Proteus mirab… -0.0579   0.174       -0.332 7.40e- 1 -4.00e-1   0.284   FALSE
10 Pseudomonas a…  0.0442   0.215        0.205 8.37e- 1 -3.77e-1   0.466   FALSE
11 Serratia marc… -0.967    0.204       -4.73  2.27e- 6 -1.37e+0  -0.566   TRUE 
12 Diabetes        0.0164   0.0521       0.314 7.53e- 1 -8.57e-2   0.118   FALSE
13 Hypertension    0.0113   0.0488       0.231 8.17e- 1 -8.44e-2   0.107   FALSE
14 Hospital_befo… -0.0336   0.0462      -0.727 4.67e- 1 -1.24e-1   0.0569  FALSE
15 Infection_Freq  0.00208  0.0206       0.101 9.20e- 1 -3.84e-2   0.0425  FALSE</code></pre>
</div>
</div>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<section id="forest-plot" class="level3">
<h3 class="anchored" data-anchor-id="forest-plot">Forest plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>forest_plot <span class="ot">&lt;-</span> tidy_lm <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">fct_reorder</span>(term, estimate)) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> term, <span class="at">x =</span> estimate)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high, <span class="at">color =</span> sig), <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimates (95% CIs)"</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"p-value &lt; 0.05"</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `geom_errorbarh()` was deprecated in ggplot2 4.0.0.
ℹ Please use the `orientation` argument of `geom_errorbar()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>forest_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`height` was translated to `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-37-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The linear model shows that bacterial species are the main drivers of MDR, indicating that certain pathogens are more prone to acquiring multiple antibiotic resistances, with <em>Klebsiella pneumoniae</em> and <em>Escherichia coli</em> displaying significantly higher MDR levels. In contrast, patient-related variables such as age, diabetes, and hypertension show no meaningful association with MDR. This lack of influence from physiological factors is intuitive, whereas prior hospitalization might have been expected to correlate with higher MDR due to potential exposure to nosocomial pathogens, however, our data do not support this relationship.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"results/images/05_MDR_forest.png"</span>), forest_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image
`height` was translated to `width`.</code></pre>
</div>
</div>
</section>
<section id="volcano-plot" class="level3">
<h3 class="anchored" data-anchor-id="volcano-plot">Volcano plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>volcano_plot <span class="ot">&lt;-</span> tidy_lm <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logpval =</span> <span class="sc">-</span><span class="fu">log10</span>(p.value)) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> logpval, <span class="at">x =</span> estimate, <span class="at">color =</span> sig, <span class="at">label =</span> term)) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">max.overlaps =</span> <span class="dv">12</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimates"</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"-log10(p-value)"</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"p-value &lt; 0.05"</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>volcano_plot  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-39-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"results/images/05_MDR_volcano.png"</span>), volcano_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="linear_model_inf_freq" class="level1">
<h1>06_linear_model_inf_freq</h1>
<section id="load-libraries-5" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries-5">Load libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>) </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"broom"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data-4" class="level3">
<h3 class="anchored" data-anchor-id="load-data-4">Load data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>infect_db <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_wide.csv"</span>),</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="first-model-is-infection-frequency-correlated-to-patient-details" class="level4">
<h4 class="anchored" data-anchor-id="first-model-is-infection-frequency-correlated-to-patient-details">First model: Is infection frequency correlated to patient details?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> infect_db <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Infection_Freq <span class="sc">~</span> Age <span class="sc">+</span> Diabetes <span class="sc">+</span> Hypertension <span class="sc">+</span> Hospital_before,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Infection_Freq ~ Age + Diabetes + Hypertension + 
    Hospital_before, data = infect_db)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5495 -0.5311  0.4547  0.5050  1.5422 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         1.5099148  0.0239272  63.105   &lt;2e-16 ***
Age                 0.0002980  0.0004167   0.715    0.475    
DiabetesYes        -0.0333012  0.0256155  -1.300    0.194    
HypertensionYes     0.0130436  0.0240009   0.543    0.587    
Hospital_beforeYes -0.0188134  0.0227260  -0.828    0.408    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.022 on 9709 degrees of freedom
Multiple R-squared:  0.0003204, Adjusted R-squared:  -9.148e-05 
F-statistic: 0.7779 on 4 and 9709 DF,  p-value: 0.5394</code></pre>
</div>
</div>
</section>
<section id="second-model-is-infection-frequency-correlated-with-the-species" class="level4">
<h4 class="anchored" data-anchor-id="second-model-is-infection-frequency-correlated-with-the-species">Second model: Is infection frequency correlated with the species?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> infect_db <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Infection_Freq <span class="sc">~</span> Species,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Infection_Freq ~ Species, data = infect_db)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.6667 -0.5454  0.3891  0.5018  1.5726 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    1.66667    0.07678  21.706   &lt;2e-16 ***
SpeciesCitrobacter spp.       -0.20513    0.09014  -2.276   0.0229 *  
SpeciesEnterobacteria spp.    -0.12131    0.08350  -1.453   0.1463    
SpeciesEscherichia coli       -0.16843    0.07792  -2.162   0.0307 *  
SpeciesKlebsiella pneumoniae  -0.05572    0.08602  -0.648   0.5172    
SpeciesMorganella morganii    -0.17352    0.09731  -1.783   0.0746 .  
SpeciesProteus mirabilis      -0.12842    0.08571  -1.498   0.1341    
SpeciesPseudomonas aeruginosa -0.11844    0.10580  -1.120   0.2629    
SpeciesSerratia marcescens    -0.23925    0.10052  -2.380   0.0173 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.022 on 9705 degrees of freedom
Multiple R-squared:  0.001677,  Adjusted R-squared:  0.0008536 
F-statistic: 2.037 on 8 and 9705 DF,  p-value: 0.03842</code></pre>
</div>
</div>
</section>
<section id="third-model-is-infection-frequency-correlated-with-multiple-drug-resistance" class="level4">
<h4 class="anchored" data-anchor-id="third-model-is-infection-frequency-correlated-with-multiple-drug-resistance">Third model: Is infection frequency correlated with multiple drug resistance?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> infect_db <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Infection_Freq <span class="sc">~</span> MDR,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Infection_Freq ~ MDR, data = infect_db)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5254 -0.5209  0.4768  0.4903  1.4992 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.525403   0.023570  64.719   &lt;2e-16 ***
MDR         -0.002239   0.004272  -0.524      0.6    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.022 on 9712 degrees of freedom
Multiple R-squared:  2.828e-05, Adjusted R-squared:  -7.468e-05 
F-statistic: 0.2747 on 1 and 9712 DF,  p-value: 0.6002</code></pre>
</div>
</div>
</section>
<section id="fourth-model-which-is-the-main-contributor-for-infection-frequency" class="level4">
<h4 class="anchored" data-anchor-id="fourth-model-which-is-the-main-contributor-for-infection-frequency">Fourth model: Which is the main contributor for infection frequency?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> infect_db <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Infection_Freq <span class="sc">~</span> Species <span class="sc">+</span> MDR <span class="sc">+</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>       Diabetes <span class="sc">+</span> Hypertension <span class="sc">+</span> Hospital_before,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Infection_Freq ~ Species + MDR + Age + Gender + 
    Diabetes + Hypertension + Hospital_before, data = infect_db)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.7094 -0.5442  0.3570  0.5261  1.6239 

Coefficients:
                                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    1.6729480  0.0817817  20.456   &lt;2e-16 ***
SpeciesCitrobacter spp.       -0.2082598  0.0902109  -2.309   0.0210 *  
SpeciesEnterobacteria spp.    -0.1253459  0.0835478  -1.500   0.1336    
SpeciesEscherichia coli       -0.1728281  0.0790654  -2.186   0.0288 *  
SpeciesKlebsiella pneumoniae  -0.0604944  0.0862912  -0.701   0.4833    
SpeciesMorganella morganii    -0.1783005  0.0974385  -1.830   0.0673 .  
SpeciesProteus mirabilis      -0.1317730  0.0857524  -1.537   0.1244    
SpeciesPseudomonas aeruginosa -0.1216909  0.1058295  -1.150   0.2502    
SpeciesSerratia marcescens    -0.2446206  0.1006925  -2.429   0.0151 *  
MDR                            0.0005037  0.0049970   0.101   0.9197    
Age                            0.0002555  0.0004168   0.613   0.5399    
GenderM                       -0.0370379  0.0258193  -1.435   0.1515    
DiabetesYes                   -0.0332748  0.0256146  -1.299   0.1940    
HypertensionYes                0.0155761  0.0240042   0.649   0.5164    
Hospital_beforeYes            -0.0194678  0.0227236  -0.857   0.3916    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.022 on 9699 degrees of freedom
Multiple R-squared:  0.002212,  Adjusted R-squared:  0.0007714 
F-statistic: 1.536 on 14 and 9699 DF,  p-value: 0.08977</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tidy_lm <span class="ot">&lt;-</span> <span class="fu">tidy</span>(model_full, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.level =</span> <span class="fl">0.95</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Species"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Yes"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"GenderM"</span>, <span class="st">"Gender_M"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq1"</span>, <span class="st">"Freq_1"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq2"</span>, <span class="st">"Freq_2"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"Freq3"</span>, <span class="st">"Freq_3"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">factor</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>))</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>tidy_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 8
   term           estimate std.error statistic  p.value conf.low conf.high sig  
   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;
 1 (Intercept)     1.67e+0  0.0818      20.5   4.34e-91  1.51e+0   1.83    TRUE 
 2 Citrobacter s… -2.08e-1  0.0902      -2.31  2.10e- 2 -3.85e-1  -0.0314  TRUE 
 3 Enterobacteri… -1.25e-1  0.0835      -1.50  1.34e- 1 -2.89e-1   0.0384  FALSE
 4 Escherichia c… -1.73e-1  0.0791      -2.19  2.88e- 2 -3.28e-1  -0.0178  TRUE 
 5 Klebsiella pn… -6.05e-2  0.0863      -0.701 4.83e- 1 -2.30e-1   0.109   FALSE
 6 Morganella mo… -1.78e-1  0.0974      -1.83  6.73e- 2 -3.69e-1   0.0127  FALSE
 7 Proteus mirab… -1.32e-1  0.0858      -1.54  1.24e- 1 -3.00e-1   0.0363  FALSE
 8 Pseudomonas a… -1.22e-1  0.106       -1.15  2.50e- 1 -3.29e-1   0.0858  FALSE
 9 Serratia marc… -2.45e-1  0.101       -2.43  1.51e- 2 -4.42e-1  -0.0472  TRUE 
10 MDR             5.04e-4  0.00500      0.101 9.20e- 1 -9.29e-3   0.0103  FALSE
11 Age             2.55e-4  0.000417     0.613 5.40e- 1 -5.62e-4   0.00107 FALSE
12 Gender_M       -3.70e-2  0.0258      -1.43  1.51e- 1 -8.76e-2   0.0136  FALSE
13 Diabetes       -3.33e-2  0.0256      -1.30  1.94e- 1 -8.35e-2   0.0169  FALSE
14 Hypertension    1.56e-2  0.0240       0.649 5.16e- 1 -3.15e-2   0.0626  FALSE
15 Hospital_befo… -1.95e-2  0.0227      -0.857 3.92e- 1 -6.40e-2   0.0251  FALSE</code></pre>
</div>
</div>
</section>
<section id="visualization-1" class="level4">
<h4 class="anchored" data-anchor-id="visualization-1">Visualization</h4>
</section>
<section id="forest-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="forest-plot-1">Forest plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>infect_plot1 <span class="ot">&lt;-</span> tidy_lm <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">fct_reorder</span>(term, estimate)) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> term, <span class="at">x =</span> estimate)) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high), <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimates (95% CIs)"</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Factors associated with infection frequency"</span>) <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"06_inf_freq_forest.png"</span>, <span class="at">plot =</span> infect_plot1, <span class="at">path =</span> <span class="fu">here</span>(<span class="st">"results/images"</span>), <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image
`height` was translated to `width`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>infect_plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`height` was translated to `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-48-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>tidy_lm <span class="ot">&lt;-</span> tidy_lm <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q.value =</span> <span class="fu">p.adjust</span>(p.value),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_significant =</span> <span class="fu">case_when</span>(q.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                                    q.value <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"no"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="volcano-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="volcano-plot-1">Volcano plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> tidy_lm <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p.value),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> sig,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> term)) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Estimates"</span>,</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"-log10(p)"</span>,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Factors associated with infection frequency"</span>,</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Factors highlighted in turquoise are significant"</span>)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"06_inf_freq_volcano.png"</span>, <span class="at">plot =</span> pl, <span class="at">path =</span> <span class="fu">here</span>(<span class="st">"results/images"</span>), <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>pl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-50-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="heatmap" class="level1">
<h1>07_heatmap</h1>
<section id="heatmap-1" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-1">HeatMap</h2>
<p>This analysis visualizes the resistance patterns of different bacterial species to various antibiotics using a heatmap. The raw dataset, which includes species, antibiotics, and resistance results (<code>R</code>, <code>S</code>, or <code>I</code>), was first transformed to create a binary <code>resistant</code> variable indicating whether a bacterium is resistant (<code>R</code>) or not. The data was then grouped by species and antibiotic to calculate the number of resistant and non-resistant cases, from which the frequency of resistance for each species-antibiotic pair was computed. The resulting heatmap uses a color gradient from blue (low resistance) through white (intermediate) to red (high resistance) to illustrate the proportion of resistant isolates, allowing for rapid identification of patterns in bacterial susceptibility. Additional analyses highlight which species exhibit the highest levels of resistance, sensitivity, or intermediate responses, providing insights into potential treatment challenges.</p>
</section>
<section id="running-code" class="level2">
<h2 class="anchored" data-anchor-id="running-code">Running Code</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_long.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#look at first few rows</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Age Gender          Species Diabetes Hypertension Hospital_before
1  37      F Escherichia coli       No           No              No
2  37      F Escherichia coli       No           No              No
3  37      F Escherichia coli       No           No              No
4  37      F Escherichia coli       No           No              No
5  37      F Escherichia coli       No           No              No
6  37      F Escherichia coli       No           No              No
  Infection_Freq Antibiotic Resistance                     Full_Name
1              0    AMX.AMP          R      Amoxicillin / Ampicillin
2              0        AMC          R Amoxicillin + Clavulanic Acid
3              0         CZ          R                     Cefazolin
4              0        FOX          R                     Cefoxitin
5              0    CTX.CRO          R      Cefotaxime / Ceftriaxone
6              0        IPM          R                      Imipenem
                     Class stringsAsFactors
1 β-lactams (Beta-lactams)            FALSE
2 β-lactams (Beta-lactams)            FALSE
3 β-lactams (Beta-lactams)            FALSE
4 β-lactams (Beta-lactams)            FALSE
5 β-lactams (Beta-lactams)            FALSE
6 β-lactams (Beta-lactams)            FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Age"              "Gender"           "Species"          "Diabetes"        
 [5] "Hypertension"     "Hospital_before"  "Infection_Freq"   "Antibiotic"      
 [9] "Resistance"       "Full_Name"        "Class"            "stringsAsFactors"</code></pre>
</div>
</div>
<section id="checking-how-many-bacteriasspecies-are-there" class="level3">
<h3 class="anchored" data-anchor-id="checking-how-many-bacteriasspecies-are-there">checking how many bacterias/species are there:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Species) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Species     n
1 Acinetobacter baumannii  2715
2        Citrobacter spp.  7215
3     Enterobacteria spp. 14955
4        Escherichia coli 91245
5   Klebsiella pneumoniae 10530
6     Morganella morganii  4575
7       Proteus mirabilis 11130
8  Pseudomonas aeruginosa  3000
9     Serratia marcescens  3840</code></pre>
</div>
</div>
</section>
<section id="how-many-antibiotics" class="level3">
<h3 class="anchored" data-anchor-id="how-many-antibiotics">how many antibiotics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Antibiotic) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Antibiotic    n
1                AMC 9947
2            AMX.AMP 9947
3                 AN 9947
4  Acide.nalidixique 9947
5                  C 9947
6                CIP 9947
7            CTX.CRO 9947
8                 CZ 9947
9     Co.trimoxazole 9947
10               FOX 9947
11           Furanes 9947
12               GEN 9947
13               IPM 9947
14         colistine 9947
15               ofx 9947</code></pre>
</div>
</div>
</section>
<section id="fixing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="fixing-the-data">fixing the data</h3>
<p>resistant - means if the results are R - e.g., True or False</p>
<p>and in the group_by- I calculate by each species by each antibiotic by each resistant. - how many true false are there in each group</p>
<p>then calculate the frequency</p>
<section id="it-is-for-each-species" class="level4">
<h4 class="anchored" data-anchor-id="it-is-for-each-species">it is for each species!!!</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculating the frequency for all of the bacterias: result = R</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>resistant_data <span class="ot">&lt;-</span> data_long <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resistant =</span> Resistance <span class="sc">==</span> <span class="st">"R"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species, Antibiotic, resistant) <span class="sc">|&gt;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">|&gt;</span>  <span class="co"># keep Species + Antibiotic grouping</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>resistant_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 270 × 5
# Groups:   Species, Antibiotic [135]
   Species                 Antibiotic        resistant     n   freq
   &lt;chr&gt;                   &lt;chr&gt;             &lt;lgl&gt;     &lt;int&gt;  &lt;dbl&gt;
 1 Acinetobacter baumannii AMC               FALSE       110 0.608 
 2 Acinetobacter baumannii AMC               TRUE         71 0.392 
 3 Acinetobacter baumannii AMX.AMP           FALSE       125 0.691 
 4 Acinetobacter baumannii AMX.AMP           TRUE         56 0.309 
 5 Acinetobacter baumannii AN                FALSE       150 0.829 
 6 Acinetobacter baumannii AN                TRUE         31 0.171 
 7 Acinetobacter baumannii Acide.nalidixique FALSE       172 0.950 
 8 Acinetobacter baumannii Acide.nalidixique TRUE          9 0.0497
 9 Acinetobacter baumannii C                 FALSE       157 0.867 
10 Acinetobacter baumannii C                 TRUE         24 0.133 
# ℹ 260 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="plotting-the-heatmap" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-heatmap">plotting the Heatmap</h3>
<p>showing the Resistance of the bacteria to antibiotics.</p>
<p>it is calculate by each bacteria.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resistant_data, <span class="fu">aes</span>(<span class="at">x =</span> Antibiotic, <span class="at">y =</span> Species, <span class="at">fill =</span> freq)) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">midpoint =</span> <span class="fl">0.50</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Resistance of the Bacteria to the Antibiotics"</span>, <span class="at">fill =</span> <span class="st">"Frequency"</span>)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot as PNG</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"results/images/07_heatmap.png"</span>), <span class="at">plot =</span> heatmap_plot, <span class="at">width =</span> <span class="dv">13</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>heatmap_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-56-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>R = Resistant: The bacteria does NOT respond to the antibiotic. The drug will likely not work.</p>
<p>S = Sensitive/Susceptible: The bacteria is killed by the antibiotic. The drug will work.</p>
<p>I = Intermediate: The bacteria is in-between, maybe the drug works at high dose, maybe not.</p>
<section id="in-the-result-column---find-how-many-sr-and-i-we-have" class="level4">
<h4 class="anchored" data-anchor-id="in-the-result-column---find-how-many-sr-and-i-we-have">In the <strong>Result column -</strong> find how many S,R and I we have</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count overall R/S/I</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Resistance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Resistance     n
1          I  2593
2          R 47901
3          S 98711</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count R/S/I per species</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Species, Resistance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Species Resistance     n
1  Acinetobacter baumannii          I    58
2  Acinetobacter baumannii          R   563
3  Acinetobacter baumannii          S  2094
4         Citrobacter spp.          I    83
5         Citrobacter spp.          R  1682
6         Citrobacter spp.          S  5450
7      Enterobacteria spp.          I   296
8      Enterobacteria spp.          R  3238
9      Enterobacteria spp.          S 11421
10        Escherichia coli          I  1667
11        Escherichia coli          R 35079
12        Escherichia coli          S 54499
13   Klebsiella pneumoniae          I   178
14   Klebsiella pneumoniae          R  3093
15   Klebsiella pneumoniae          S  7259
16     Morganella morganii          I    48
17     Morganella morganii          R   748
18     Morganella morganii          S  3779
19       Proteus mirabilis          I   140
20       Proteus mirabilis          R  2309
21       Proteus mirabilis          S  8681
22  Pseudomonas aeruginosa          I    70
23  Pseudomonas aeruginosa          R   628
24  Pseudomonas aeruginosa          S  2302
25     Serratia marcescens          I    53
26     Serratia marcescens          R   561
27     Serratia marcescens          S  3226</code></pre>
</div>
</div>
</section>
</section>
<section id="which-species-has-the-most-r" class="level3">
<h3 class="anchored" data-anchor-id="which-species-has-the-most-r">which species has the most R</h3>
<p>Escherichia coli</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Resistance <span class="sc">==</span> <span class="st">"R"</span>) <span class="sc">|&gt;</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_R =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count_R)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  Species                 count_R
  &lt;chr&gt;                     &lt;int&gt;
1 Escherichia coli          35079
2 Enterobacteria spp.        3238
3 Klebsiella pneumoniae      3093
4 Proteus mirabilis          2309
5 Citrobacter spp.           1682
6 Morganella morganii         748
7 Pseudomonas aeruginosa      628
8 Acinetobacter baumannii     563
9 Serratia marcescens         561</code></pre>
</div>
</div>
</section>
<section id="which-species-has-the-most-s" class="level3">
<h3 class="anchored" data-anchor-id="which-species-has-the-most-s">which Species has the most S</h3>
<p>Escherichia coli</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Resistance <span class="sc">==</span> <span class="st">"S"</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_S =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count_S)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  Species                 count_S
  &lt;chr&gt;                     &lt;int&gt;
1 Escherichia coli          54499
2 Enterobacteria spp.       11421
3 Proteus mirabilis          8681
4 Klebsiella pneumoniae      7259
5 Citrobacter spp.           5450
6 Morganella morganii        3779
7 Serratia marcescens        3226
8 Pseudomonas aeruginosa     2302
9 Acinetobacter baumannii    2094</code></pre>
</div>
</div>
</section>
<section id="which-species-has-the-most-i" class="level3">
<h3 class="anchored" data-anchor-id="which-species-has-the-most-i">which Species has the most I</h3>
<p>Escherichia coli</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="sc">|&gt;</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Resistance <span class="sc">==</span> <span class="st">"I"</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_I =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count_I)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  Species                 count_I
  &lt;chr&gt;                     &lt;int&gt;
1 Escherichia coli           1667
2 Enterobacteria spp.         296
3 Klebsiella pneumoniae       178
4 Proteus mirabilis           140
5 Citrobacter spp.             83
6 Pseudomonas aeruginosa       70
7 Acinetobacter baumannii      58
8 Serratia marcescens          53
9 Morganella morganii          48</code></pre>
</div>
</div>
<ul>
<li><p>Frequency of infections per patient.</p></li>
<li><p>Encoded categories:</p>
<ul>
<li><p><code>0</code> → Never</p></li>
<li><p><code>1</code> → Rarely</p></li>
<li><p><code>2</code> → Regularly</p></li>
<li><p><code>3</code> → Often</p></li>
</ul></li>
<li><p>Includes anomalies such as <code>"unknown"</code>, <code>"error"</code>, <code>"missing"</code>.</p>
<h3 id="section" class="anchored"></h3></li>
</ul>
</section>
</section>
</section>
<section id="pca" class="level1">
<h1>08_PCA</h1>
</section>
<section id="pca-of-antibiotic-resistance-patterns-across-different-species" class="level1">
<h1><strong>PCA of Antibiotic Resistance Patterns Across Different Species</strong></h1>
<p>To explore shared patterns of antibiotic resistance across bacterial species, we performed a Principal Component Analysis (PCA) on the numeric resistance profiles. This approach reveals the main axes of variation in multi-drug resistance and allows us to visualize whether species cluster according to their resistance signatures.</p>
<section id="load-libraries-6" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries-6">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"here"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"broom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data-5" class="level2">
<h2 class="anchored" data-anchor-id="load-data-5">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>MDR_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/03_dat_aug_wide.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-resistance-categories-to-numeric" class="level2">
<h2 class="anchored" data-anchor-id="convert-resistance-categories-to-numeric">Convert Resistance Categories to Numeric</h2>
<p>In 03_augment.qmd we transform the categorical resistance values (R, I, S) into numeric scores (1, 0.5, 0), allowing us to quantitatively analyze resistance patterns across samples.</p>
</section>
<section id="run-initial-pca" class="level2">
<h2 class="anchored" data-anchor-id="run-initial-pca">Run Initial PCA</h2>
<p>We perform a PCA using only the antibiotic-resistance columns, scaling the variables to unit variance to ensure equal contribution across antibiotics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>antibiotics_cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(MDR_df)[<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span>(<span class="fu">ncol</span>(MDR_df)<span class="sc">-</span><span class="dv">1</span>))]</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>pca_fit <span class="ot">&lt;-</span> MDR_df <span class="sc">|&gt;</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(antibiotics_cols)) <span class="sc">|&gt;</span> </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>pca_all_plot <span class="ot">&lt;-</span> pca_fit <span class="sc">|&gt;</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(MDR_df) <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> .fittedPC1,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> .fittedPC2,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PC2"</span>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>pca_all_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-65-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As seen in the initial PCA plot, the structure of the data is dominated by the large number of <em>E. coli</em> isolates, making it difficult to observe patterns from other species. This imbalance can also bias the interpretation of the principal components, since one species disproportionately drives the variance. To avoid this dominance and obtain a clearer, more balanced view of resistance patterns, we downsample each species to the same number of isolates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"results/images/08_PCA_all.png"</span>), pca_all_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
</div>
</section>
<section id="create-balanced-dataset" class="level2">
<h2 class="anchored" data-anchor-id="create-balanced-dataset">Create Balanced Dataset</h2>
<p>We calculate the minimum number of isolates per species to determine the target size for constructing a balanced dataset. We downsample each species to the same number of isolates, preventing highly abundant species from dominating the PCA structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>min_n <span class="ot">&lt;-</span> MDR_df <span class="sc">|&gt;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Species) <span class="sc">|&gt;</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">min</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="ot">&lt;-</span> MDR_df <span class="sc">|&gt;</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> min_n) <span class="sc">|&gt;</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="sc">|&gt;</span> </span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  Species                     n
  &lt;chr&gt;                   &lt;int&gt;
1 Acinetobacter baumannii   177
2 Citrobacter spp.          177
3 Enterobacteria spp.       177
4 Escherichia coli          177
5 Klebsiella pneumoniae     177
6 Morganella morganii       177
7 Proteus mirabilis         177
8 Pseudomonas aeruginosa    177
9 Serratia marcescens       177</code></pre>
</div>
</div>
</section>
<section id="run-pca-on-balanced-dataset" class="level2">
<h2 class="anchored" data-anchor-id="run-pca-on-balanced-dataset">Run PCA on Balanced Dataset</h2>
<p>We repeat the PCA on the balanced dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>pca_fit_balanced <span class="ot">&lt;-</span> balanced_df <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(antibiotics_cols)) <span class="sc">|&gt;</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>pca_downsampling_plot <span class="ot">&lt;-</span> pca_fit_balanced <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(balanced_df) <span class="sc">|&gt;</span> </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> .fittedPC1,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> .fittedPC2,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PC2"</span>)</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>pca_downsampling_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-69-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The PCA of the balanced dataset shows that most species exhibit substantial overlap in their resistance profiles, indicating that many antibiotic-resistance patterns are shared across taxa. However, some species occupy more distinct regions of the PCA space. For instance, <em>Pseudomonas aeruginosa</em> and <em>Serratia marcescens</em> are positioned predominantly toward the right side of the plot, forming more defined clusters that show limited overlap with the left cloud dominated by <em>Escherichia coli</em>. This separation suggests that these species follow characteristic combinations of resistance traits that differ from the broader and more heterogeneous profiles observed in <em>E. coli</em> and other Enterobacterales. Overall, while many species share common multidrug-resistance patterns, a subset displays more distinct resistance signatures that set them apart from the main continuum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"results/images/08_PCA_downsampling.png"</span>), pca_downsampling_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>