---
title: "04_description"
format: html
---

# Description of the Dataset

## Load Libraries

```{r}
#| warning: false
#| message: false

library(tidyverse)
library(here)
library(table1)
library(patchwork)
```

## Load Data

```{r}
mdr_data <- read.csv(here("data/cleaned_bacteria_data.csv"))
mdr_long <- read.csv(here("data/aug_long_bacteria_data.csv"))
mdr_wide <- read.csv(here("data/aug_wide_bacteria_data.csv"))
```

## Load Functions

```{r}
source(here("R/99_proj_func.R"))
```

## Data Inspection

```{r}
# Number of rows & columns
dim(mdr_data)
```

```{r}
mdr_data |> sample_n(10)
```

## Data Table

```{r}
# Table describing the data per species
table1(
  ~ Age + Gender  + Diabetes + Hypertension + Hospital_before +
    Infection_Freq +
    AMX.AMP + AMC + CZ + FOX + CTX.CRO + IPM + GEN + AN +
    Acide.nalidixique + ofx + CIP + C + Co.trimoxazole +
    Furanes + colistine
  | Species,
  data = mdr_data
)
```

## Table Describing Antibiotic Full Names & Class

```{r}
mdr_long |> 
  distinct(Antibiotic, Full_Name, Class)
```

## Visualisation of Variable Distributions

**Age and Gender**

```{r}
#| warning: false
 
p1  <- mdr_wide |> 
  ggplot(data = _, 
              aes(x = age_group, fill = Gender)) +
  geom_bar(stat = "count", color = "black") + 
  scale_y_continuous(breaks = seq(0, 2000, 250)) +
  labs( x = "Age", 
        y = "Count",
        title = "Age Distribution by Gender") +
  theme(plot.title = element_text(hjust = 0.5, size = 20),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

save_png(
  plot     = p1,
  filename = here::here("results/images/04_Age_Gender.png")
)
```

**Species**

```{r}
#| warning: false

p2 <- mdr_data |> 
  ggplot(data = _, 
         aes(x = Species, fill = Species)) + 
  geom_bar(color = "black") +
    geom_text(stat = "count",
    aes(label = ..count..),
    vjust = -0.2,        # raise text above bars
    size = 2.8
  ) +
  scale_y_continuous(breaks = seq(0, 6000, 1000)) +
  labs( x = "Species", 
        y = "Count",
        title = "Species Distribution") +
  theme(plot.title = element_text(hjust = 0.5, size = 20),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 10),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

save_png(
  plot     = p2,
  filename = here::here("results/images/04_Species.png")
)
```

**Age Distribution per Species**

```{r}
p3 <- ggplot(mdr_data, aes(x = Species, y = Age, fill = Species)) +
  geom_boxplot(color = "black") +
  scale_y_continuous(breaks = seq(0, 90, 15)) +
  labs(title = "Age Distribution by Species",
       x = "Species",
       y = "Age") +
  theme(plot.title = element_text(hjust = 0.5, size = 20),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

save_png(
  plot     = p3,
  filename = here::here("results/images/04_Age_Species.png")
)
```

**Hypertension, Diabetes, Hospital before, Infection Freq**

```{r}
#| warning: false
#| message: false

p4 <- mdr_data |> 
  ggplot(data = _, 
         aes(x = Diabetes, fill = Diabetes)) +
  geom_bar(stat = "count", color = "black") +
  labs(y = "Count",
       title = "Diabetes") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(hjust = 1, size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

p5 <- mdr_data |> 
  ggplot(data = _, 
         aes(x = Hypertension, fill = Hypertension)) +
  geom_bar(stat = "count", color = "black") +
  labs( y = "Count",
        title = "Hypertension") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(hjust = 1, size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

p6 <- mdr_data |> 
  ggplot(data = _, 
         aes(x = Hospital_before, fill = Hospital_before)) +
  geom_bar(stat = "count", color = "black") +
  labs( y = "Count",
        title = "Hospital Before") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(hjust = 1, size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

p7 <- mdr_data |> 
  mutate(Infection_Freq = factor(Infection_Freq, levels = c(0,1,2,3))) |>
  ggplot(data = _, 
         aes(x = Infection_Freq,  fill = Infection_Freq)) +
  geom_bar(stat = "count", color = "black") +
  labs( y = "Count",
        title = "Infection Freq") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.text.x = element_text(hjust = 1, size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14),
        legend.position = "none")

p8 <- (p4 + p5) / (p6 + p7)

save_png(
  plot     = p8,
  filename = here::here("results/images/04_Characteristics.png")
)
```

**Antibiotic Resistance Profiles**

```{r}
# Convert resistance to a factor 
mdr_long$Resistance <- factor(mdr_long$Resistance,
                              levels = c("S","I","R"))

p9 <- ggplot(mdr_long, aes(x = Antibiotic, fill = Resistance)) +
  geom_bar(position = "fill", color = "black") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Resistance Profile by Antibiotic",
    x = "Antibiotic",
    y = "Percent"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 18),
    axis.text.x = element_text(angle = 60, hjust = 1, size = 10),
    axis.title.x = element_text(size = 14),
    axis.title.y = element_text(size = 14)
  )

save_png(
  plot     = p9,
  filename = here::here("results/images/04_Resistance_Profile.png")
)
```
