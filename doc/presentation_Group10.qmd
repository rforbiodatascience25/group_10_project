---
title: "Antibiotic Resistance"
subtitle: "Project Group 10"
author: "Edene Levine · Molly Hong-Minh · Pablo Vivero · Vinit Nilesh Vasa"
format: 
  revealjs:
    slide-number: c/t
    title-slide-attributes:
      data-background-color: "#003049"
      data-background-opacity: "1"
editor: visual
---

## Antibiotic Resistance

Aim:

-   Explore antibiotic resistance profile across species

-   Compare resistance profiles and assess the influence of different variables

-   Perform PCA to identify clustering based on resistance profiles

[**Data:** https://www.kaggle.com/datasets/adilimadeddinehosni/multi-resistance-antibiotic-susceptibility/data]{style="font-size: 70%;"}

## Data Processing & Description

:::::: columns
:::: {.column width="40%"}
**Cleaning Data**

::: incremental
-   Load data
-   Remove NAs, duplicates & unnecessary columns
-   Identify naming inconsistencies and rename accordingly
:::
::::

::: {.column width="60%"}
![](images/04_Age_Gender.png){width="100%"}
:::
::::::

## Data Augment

-   Loaded cleaned bacteria dataset
-   Added antibiotic names and classes
-   Reshaped to long format and joined tables
-   Created MDR score (R = 1, I = 0.5, S = 0)
-   Converted variables to factors and added age groups
-   Final outputs: aug_long_bacteria_data.csv and aug_wide_bacteria_data.csv {.incremental}

## Linear Model MDR {.smaller}

Analysis of how `age`, `gender`, `bacterial species`, `diabetes`, `hypertension`, `prior hospitalisation` and `infection frequency` influence the number of antibiotic resistances in a contracted infection using a linear model.

:::::: columns
:::: {.column width="50%"}
### [Workflow]{style="font-size:0.6em"}

::: incremental
-   **`lm()`**: fits the linear model predicting MDR
-   **`broom::tidy()`**: extracts coefficients, confidence intervals, and p-values
-   **`mutate()`**: cleans variable names and adds significance flag
-   **`stringr::str_replace()`**: standardises variable labels
:::
::::

::: {.column width="50%"}
### [Code]{style="font-size:0.6em"}

``` r
#Linear model
linear_model <- MDR_df |> 
  lm(formula = MDR ~ Age + Gender + Species + Diabetes + Hypertension + Hospital_before + Infection_Freq,
     data = _)
     
     ...

#Tidy format     
tidy_lm <- tidy(linear_model, 
     conf.int = TRUE,
     conf.level = 0.95) |> 
  mutate(term = str_replace(term, "Species", "")) |> 
  mutate(term = str_replace(term, "Yes", "")) |> 
  mutate(term = str_replace(term, "GenderM", "Gender_M")) |> 
  mutate(term = str_replace(term, "Freq1", "Freq_1")) |>
  mutate(term = str_replace(term, "Freq2", "Freq_2")) |>
  mutate(term = str_replace(term, "Freq3", "Freq_3")) |> 
  mutate(sig = factor(p.value < 0.05))
```
:::
::::::

## Linear Model MDR {.smaller}

::::: columns
::: {.column width="50%"}
#### Forest Plot

![](images/05_MDR_forest.png){style="\"width:100%"}
:::

::: {.column width="50%"}
#### Volcano Plot

![](images/05_MDR_volcano.png){style="\"width:100%"}
:::
:::::

[Only bacterial species significantly affect MDR]{style="font-size:0.7em; text-align:center; display:block;"}

## Linear Model Infection frequency

:::::: columns
:::: {.column width="40%"}
::: {style="max-width:100%; font-size:0.9rem; overflow:auto;"}
| Model 1         | Model 2           | Model 3    | Model 4      |
|-----------------|-------------------|------------|--------------|
| Patient details | Bacterial species | MDR        | Multivariate |
| p = 0.5394      | p = 0.03842       | p = 0.6002 | p = 0.08977  |
:::
::::

::: {.column width="60%"}
![](images/infect_plot1.png){style="\"width:100%"}
:::
::::::

## Bacterial Resistance Heatmap

![](images/heatmap_resistance.png){fig-align="center"}

[Shows resistance patterns across bacterial species using the long-format dataset: E. coli and K. pneumoniae show the highest resistance (red), most other species remain largely sensitive (blue), and several antibiotics stay effective across multiple species.]{style="font-size: 50%;"}

</p>

## PCA {.smaller}

Identify shared patterns of antibiotic resistance across bacterial species.

:::::: columns
:::: {.column width="50%"}
### [Workflow]{style="font-size:0.6em"}

::: incremental
-   **`select()`**: extracts only the antibiotic-resistance columns used for PCA
-   **`prcomp()`**: performs the PCA with variable scaling
-   **`augment()`**: attaches PCA scores (PC1, PC2…) back to the original dataset
-   **`count()`** — determines number of isolates per species
-   **`slice_sample()`**: downsamples species to equal sizes for balanced PCA
:::
::::

::: {.column width="50%"}
### [Code]{style="font-size:0.6em"}

``` r
#Variable selection and PCA
antibiotics_cols <- colnames(MDR_df)[c(8:(ncol(MDR_df)-1))]

pca_fit <- MDR_df |>
  select(all_of(antibiotics_cols)) |> 
  prcomp(scale = TRUE)
     
     ...

#Augment the original dataset   
pca_all_plot <- pca_fit |> 
  augment(MDR_df)
  
     ...
     
#Downsampling
min_n <- MDR_df |>
  count(Species) |> 
  summarise(min(n)) |> 
  pull()

balanced_df <- MDR_df |>
  group_by(Species) |>
  slice_sample(n = min_n) |>
  ungroup()
```
:::
::::::

## PCA {.smaller}

::::: columns
::: {.column width="50%"}
#### Before downsampling

![](images/08_PCA_all.png){style="\"width:100%"}
:::

::: {.column width="50%"}
#### After downsampling

![](images/08_PCA_downsampling.png){style="\"width:100%"}
:::
:::::

[After balancing species counts, the PCA shows largely shared resistance patterns across taxa, with only a few species, such as P. aeruginosa and S. marcescens, forming distinct clusters separate from the main E. coli-dominated continuum.]{style="font-size:0.7em; text-align:center; display:block;"}
