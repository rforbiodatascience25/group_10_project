---
title: "02_resistance_analysis"
format: html
editor: visual
---

## Edene - s240875

⁠Creating a heatmap - raw bacteria column antibiotics - get pattern of resistance

## Running Code

```{r}
library(tidyverse)
library(here)

my_data <- read.csv(here("data/cleaned_bacteria_data.csv"))

```

```{r}
#look at first few rows
head(my_data)
colnames(my_data)
```

### from lab03 :

```{r}
data_long <- my_data |>
  pivot_longer(
    cols = AMX.AMP:colistine, 
    names_to = "Antibiotic",
    values_to = "Result"
  )
data_long
```

-   All columns starting from `AMX.AMP` up to `colistine`, in the order they appear in the data.

### checking how many bacterias/species are there:

```{r}
data_long |>
  count(Species) 

```

### how many antibiotics

```{r}
data_long |>
  count(Antibiotic) 
```

```{r}
write.csv(data_long, here("data/data_long.csv"), row.names = FALSE)

```

### fixing the data

resistant - means if the results are R - e.g., True or False

and in the group_by- I calculate by each species by each antibiotic by each resistant. - how many true false are there in each group

then calculate the frequency

#### it is for each species!!!

```{r}
#calculating the frequency for all of the bacterias: result = R
resistant_data <- data_long |>
  mutate(resistant = Result == "R") |>
  group_by(Species, Antibiotic, resistant) |>
  summarise(n = n()) |>
  mutate(freq = n / sum(n))

  resistant_data
```

saving the table:

```{r}
write.csv(resistant_data, here("data/resistant_data.csv"), row.names = FALSE)

```

### Heatmap - Lab3

showing the Resistance of the bacteria to antibiotics.

```{r}

ggplot(resistant_data, aes(x = Antibiotic, y = Species, fill = freq)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0.50) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 90, hjust = 1, size = 7),
    axis.text.y = element_text(size = 7),
    axis.title = element_text(face = "bold"),
    plot.title = element_text(face = "bold")
  ) +
  labs(title = "Resistance of the Bacteria to the Antibiotics", fill = "Frequency")

```

R = Resistant: The bacteria does NOT respond to the antibiotic. The drug will likely not work.

S = Sensitive/Susceptible: The bacteria is killed by the antibiotic. The drug will work.

I = Intermediate: The bacteria is in-between, maybe the drug works at high dose, maybe not.

#### In the **Result column -** find how many S,R and I we have

```{r}
# Count overall R/S/I

data_long |>
  count(Result)
```

```{r}
# Count R/S/I per species
data_long |>
  count(Species, Result)
```

### which species has the most R

Escherichia coli

```{r}
data_long |>
  filter(Result == "R") |>
  group_by(Species) |>
  summarise(count_R = n()) |> 
  arrange(desc(count_R)) 
```

### which Species has the most S

Escherichia coli

```{r}
data_long |>
  filter(Result == "S") |>
  group_by(Species) |>
  summarise(count_S = n()) |> 
  arrange(desc(count_S)) 
```

### which Species has the most I

Escherichia coli

```{r}
data_long |>
  filter(Result == "I") |>
  group_by(Species) |>
  summarise(count_I = n()) |> 
  arrange(desc(count_I)) 
```

### 

-   Frequency of infections per patient.

-   Encoded categories:

    -   `0` → Never

    -   `1` → Rarely

    -   `2` → Regularly

    -   `3` → Often

-   Includes anomalies such as `"unknown"`, `"error"`, `"missing"`.

    ### 
